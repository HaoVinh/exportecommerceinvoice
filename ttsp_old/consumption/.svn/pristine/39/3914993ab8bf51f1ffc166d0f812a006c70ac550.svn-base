<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:h="http://java.sun.com/jsf/html" template="/pages/home.xhtml">
	<ui:define name="content">
		<h3
			style="margin: 0px; color: #00145a; font-weight: bold; font-size: 15px !important; line-height: 13px; padding-top: 10px; padding-left: 10px;">Hợp
			đồng tiêu thụ sản phẩm</h3>
		<p:separator />
		<div class="col-md-12">
			<h:form id="menuformid">
				<span style="position: absolute; right: 15px; top: 5px; z-index: 1;">
					<p:commandLink title="Prev" update="menuformid:tabview1:group1"
						styleClass="btnexportpos" action="#{contractBean.nextOrPrev(0)}"
						style="margin-right:2px;">
						<i class="fa fa-caret-left" aria-hidden="true"></i>
					</p:commandLink> <p:commandLink title="Prev" update="menuformid:tabview1:group1"
						styleClass="btnexportpos" action="#{contractBean.nextOrPrev(1)}">
						<i class="fa fa-caret-right" aria-hidden="true"></i>
					</p:commandLink>
				</span>
				<p:tabView id="tabview1" styleClass="clearfix label12 tabview_lix">
					<p:tab id="tab1" title="Nhập chi tiết hợp đồng">
						<h:panelGroup id="group1">
							<div class="col-md-12"
								style="padding-left: 0px !important; padding-right: 0px !important; background-color: #eeeeee;">
								<div class="col-md-9"
									style="padding-left: 0px !important; padding-right: 0px !important; background-color: #eeeeee;">
									<div class="row" style="margin-top: 18px;">
										<div class="col-md-9"
											style="padding-left: 15px !important; padding-right: 0px !important; margin-bottom: 2px;">
											<p:commandLink update="dlg1,messages" process="@this"
												action="#{contractBean.showDialogAddContractDetail()}"
												styleClass="btn_primmary"
												style="margin-left:0px; margin-right:3px; height:29px !important;line-height:29px !important;">
												<i class="fa fa-plus" aria-hidden="true"></i>
												<span>Thêm</span>
											</p:commandLink>
											<p:commandLink process="@this" update="dlg1,messages"
												action="#{contractBean.showDialogEditContractDetail()}"
												styleClass="btn_primmary"
												style="margin-left:0px; margin-right:3px;height:29px !important;line-height:29px !important;">
												<i class="fa fa-pencil" aria-hidden="true"></i>
												<span>Chỉnh sửa</span>
											</p:commandLink>
											<h:panelGroup
												rendered="#{contractBean.contractCrud !=null and contractBean.contractCrud.id==0 and contractBean.listContractDetail !=null and contractBean.listContractDetail.size()>0}">
												<h6
													style="color: #ca1717; font-weight: bold; display: inline-block;">Phiếu
													copy chưa được lưu bấm lưu/cập nhật</h6>
											</h:panelGroup>
										</div>
										<div class="col-md-3"
											style="padding-left: 0px !important; padding-right: 15px !important; text-align: right; margin-bottom: 2px;">
											<span class="btn_icnx"
												style="background-color: #07a800 !important;"> <p:commandLink
													ajax="false" action="#{contractBean.exportExcel()}"
													title="Xuất file excel">
													<i class="fa fa-file-excel-o" aria-hidden="true"></i>
												</p:commandLink>
											</span> <span class="btn_icnx"
												style="background-color: #807a7aeb !important;"> <p:commandLink
													action="#{contractBean.copyContract()}"
													title="Copy hợp đồng" update="menuformid:tabview1:group1">
													<i class="fa fa-files-o" aria-hidden="true"></i>
												</p:commandLink>
											</span>
										</div>
									</div>
									<div class="row" style="margin-bottom: 20px;">
										<p:dataTable value="#{contractBean.listContractDetail}"
											lazy="false" paginatorPosition="bottom"
											rowsPerPageTemplate="90,180,250" selectionMode="single"
											styleClass="tablenhapsp" scrollHeight="500"
											selection="#{contractBean.contractDetailSelect}"
											paginator="true" rowKey="#{item.id}" scrollable="true"
											id="tablect" widgetVar="tablect" resizableColumns="true"
											filteredValue="#{contractBean.listContractDetailFillter}"
											var="item">
											<p:ajax event="rowDblselect"
												listener="#{contractBean.showDialogEditContractDetail()}"
												update="dlg1" />
											<p:column headerText="" width="30" styleClass="textcenter">
												<p:commandLink
													update="tablect,messages,menuformid:tabview1:tongtien"
													styleClass="trash_del" process="@this"
													actionListener="#{contractBean.deleteContactDetail(item)}">
													<span class="fa fa-trash-o"></span>
													<p:confirm icon="ui-icon-alert" />
												</p:commandLink>
											</p:column>
											<p:column headerText="ID" width="30" styleClass="textcenter">
												<h:outputText value="#{item.id}" />
											</p:column>
											<p:column headerText="MASP" width="40"
												filterBy="#{item.product.product_code}"
												filterMatchMode="contains">
												<h:outputText value="#{item.product.product_code}" />
											</p:column>
											<p:column headerText="Sản phẩm" width="270"
												filterBy="#{contractBean.formatHandler.converViToEn(item.product.product_name)}"
												filterMatchMode="contains">
												<h:outputText style="white-space: initial;"
													value="#{item.product.product_name}" />
											</p:column>
											<p:column headerText="ĐVT" width="30">
												<h:outputText value="#{item.product.unit}" />
											</p:column>
											<p:column headerText="Số lượng" width="50">
												<h:outputText value="#{item.quantity}" />
											</p:column>
											<p:column headerText="Đơn giá" width="70">
												<h:outputText value="#{item.unit_price}" />
											</p:column>
											<p:column headerText="Thành tiền" width="70"
												styleClass="textright">
												<h:outputText value="#{item.total}" />
											</p:column>
											<p:column headerText="Lợi nhuận" width="60"
												styleClass="textright">
												<h:outputText
													value="#{item.profit==0? '' : contractBean.formatHandler.getNumberFormat(item.profit,1000)}" />
											</p:column>
											<p:column headerText="Khuyến mãi" width="60"
												styleClass="textcenter">
												<p:selectBooleanCheckbox value="#{item.promotion}">
													<p:ajax update="messages" process="@this"
														listener="#{contractBean.updateContractDetail(item)}" />
												</p:selectBooleanCheckbox>
											</p:column>
										</p:dataTable>
									</div>
								</div>
								<div class="col-md-3"
									style="padding-left: 10px !important; padding-right: 0px !important; height: 641px; background-color: white;">
									<div class="row" style="margin-top: 20px;">
										<div class="col-md-6"
											style="padding-left: 0px !important; padding-right: 3px !important;">
											<label>Mã hợp đồng</label>
										</div>
										<div class="col-md-6"
											style="padding-left: 3px !important; padding-right: 0px !important;">
											<label>Số hợp đồng</label>
										</div>
									</div>
									<div class="row">
										<div class="col-md-6"
											style="padding-left: 0px !important; padding-right: 3px !important;">
											<p:inputText readonly="true"
												value="#{contractBean.contractCrud.contract_code}" />
										</div>
										<div class="col-md-6"
											style="padding-left: 3px !important; padding-right: 0px !important;">
											<p:inputText readonly="false"
												value="#{contractBean.contractCrud.voucher_code}" />
										</div>
									</div>
									<div class="row" style="margin-top: 10px;">
										<div class="col-md-12"
											style="padding-left: 0px !important; padding-right: 0px !important;">
											<label>Khách hàng</label>
										</div>
										<div class="col-md-12"
											style="padding-left: 0px !important; padding-right: 0px !important;">
											<div class="nhapnpp">
												<span class="fa fa-search"></span>
												<p:autoComplete style="width:100%;"
													placeholder="Tìm khách hàng"
													value="#{contractBean.contractCrud.customer}"
													queryDelay="900" maxResults="200"
													converter="abstractConverter" minQueryLength="2"
													completeMethod="#{contractBean.completeCustomer}" var="p"
													itemLabel="#{p.customer_name}" itemValue="#{p}"
													forceSelection="true" onclick="this.select();">
													<p:column style="width:50px">
														<h:outputText value="#{p.customer_code}" />
													</p:column>
													<p:column style="width:150px">
														<h:outputText value="#{p.customer_name}" />
													</p:column>
												</p:autoComplete>
											</div>
										</div>
									</div>
									<div class="row" style="margin-top: 10px;">
										<div class="col-md-6"
											style="padding-left: 0px !important; padding-right: 3px !important;">
											<label>Ngày bắt đầu</label>
										</div>
										<div class="col-md-6"
											style="padding-left: 3px !important; padding-right: 0px !important;">
											<label>Ngày kết thúc</label>
										</div>
										<div class="col-md-6"
											style="padding-left: 0px !important; padding-right: 3px !important;">
											<p:calendar
												value="#{contractBean.contractCrud.effective_date}"
												pattern="dd/MM/yyyy" showOn="button" mask="99/99/9999"
												showButtonPanel="true" />
										</div>
										<div class="col-md-6"
											style="padding-left: 3px !important; padding-right: 0px !important;">
											<p:calendar value="#{contractBean.contractCrud.expiry_date}"
												pattern="dd/MM/yyyy" showOn="button" mask="99/99/9999"
												showButtonPanel="true" />
										</div>
									</div>
									<div class="row" style="margin-top: 10px;">
										<div class="col-md-6"
											style="padding-left: 0px !important; padding-right: 3px !important;">
											<label>Ngày hợp đồng</label>
										</div>
										<div class="col-md-6"
											style="padding-left: 3px !important; padding-right: 0px !important;">
											<label>Đơn vị tiền</label>
										</div>
									</div>
									<div class="row">
										<div class="col-md-6"
											style="padding-left: 0px !important; padding-right: 3px !important;">
											<p:calendar
												value="#{contractBean.contractCrud.contract_date}"
												pattern="dd/MM/yyyy" showOn="button" mask="99/99/9999"
												showButtonPanel="true" />
										</div>
										<div class="col-md-6"
											style="padding-left: 3px !important; padding-right: 0px !important;">
											<p:selectOneMenu
												value="#{contractBean.contractCrud.currency}"
												converter="abstractConverter" effect="fade" var="t"
												style="width:100%;">
												<f:selectItem itemLabel="--select--" itemValue="#{null}" />
												<f:selectItems value="#{contractBean.listCurrency}"
													var="theme" itemLabel="#{theme.currency_type}"
													itemValue="#{theme}" />
												<p:column>
													<h:outputText value="#{t.currency_type}" />
												</p:column>
												<p:column>
													<h:outputText value="#{t.symbol}" />
												</p:column>
											</p:selectOneMenu>
										</div>
									</div>
									<div class="row" style="margin-top: 10px;">
										<div class="col-md-12"
											style="padding-left: 0px !important; padding-right: 0px !important;">
											<p:selectBooleanCheckbox
												style="font-size: 14px;color: #a10808;"
												value="#{contractBean.contractCrud.liquidated}"
												itemLabel="Đã thanh lý">
												<p:ajax update="@this"
													listener="#{contractBean.updateContract()}" />
											</p:selectBooleanCheckbox>
										</div>
									</div>
									<div class="row" style="margin-top: 20px;">
										<div class="col-md-12"
											style="padding-left: 0px !important; padding-right: 0px !important;">
											<div style="width: 230px; margin: 0 auto;">
												<p:fieldset id="tongtien" legend="Tổng tiền"
													styleClass="fieldsetclass2 label12 classfixtopfieldset">
													<span>#{contractBean.formatHandler.getNumberFormat(contractBean.sumContract(),100)}</span>
												</p:fieldset>
											</div>
										</div>
									</div>
									<div class="row"
										style="position: absolute; bottom: 12px; width: 98%; text-align: center;">
										<p:commandLink styleClass="btn_primmary"
											action="#{contractBean.saveOrUpdate()}"
											update="menuformid:tabview1:group1,menuformid:tabview1:tablenc">
											<i class="fa fa-floppy-o" aria-hidden="true"></i>
											<span>Lưu/Cập nhật</span>
										</p:commandLink>
										<p:commandLink styleClass="btn_new"
											action="#{contractBean.createNew()}"
											update="menuformid:tabview1:group1" style="margin-left:10px;">
											<i class="fa fa-file-o" aria-hidden="true"></i>
											<span>Tạo mới</span>
										</p:commandLink>
										<p:commandLink styleClass="btn_printtt"
											action="#{contractBean.debtTracking()}"
											update="menuformid:tabview1:group1" style="margin-left:10px;">
											<i class="fa fa-eye" aria-hidden="true"></i>
											<span>Theo dõi công nợ</span>
										</p:commandLink>
									</div>
								</div>
							</div>
						</h:panelGroup>
					</p:tab>
					<p:tab id="tab2" title="Danh sách hợp đồng">
						<div class="col-md-12"
							style="padding-left: 0px !important; padding-right: 0px !important; background-color: #eeeeee;">
							<div class="row"
								style="margin-top: 25px; margin-left: 16px !important; background: white; margin-right: 16px !important; height: 40px; padding-top: 6px; padding-left: 5px;">
								<p:commandLink styleClass="btn_destroy" id="xoact"
									update="messages,menuformid:tabview1:tablenc"
									action="#{contractBean.deleteContract()}">
									<i class="fa fa-trash" aria-hidden="true"></i>
									<span>Xóa</span>
									<p:confirm icon="ui-icon-alert" />
								</p:commandLink>
								<p:commandLink id="idorder" styleClass="btn_primmary"
									style="margin-left:5px;">
									<i class="fa fa-search" aria-hidden="true"></i>
									<span>Tìm kiếm</span>
								</p:commandLink>
								<p:commandLink styleClass="btn_printtt"
									style="margin-left:10px;" ajax="false"
									action="#{contractBean.exportExceltonghop()}"
									title="Xuất file excel">
									<i class="fa fa-file-excel-o" aria-hidden="true"></i>
									<span>Xuất file excel</span>
								</p:commandLink>
								<p:commandLink styleClass="btn_primmary"
									style="margin-left:10px;" ajax="false"
									action="#{contractBean.tinhlaithanhtien()}"
									title="Tính lại thành tiền cho tất cả chi tiết hợp đồng (số lượng * đơn giá = thành tiền làm tròn 2 số lẻ)">
									<i class="fa fa-refresh" aria-hidden="true"></i>
									<span>Cập nhật tiền</span>
								</p:commandLink>
								<p:overlayPanel id="imagePanel" for="idorder" hideEffect="fade"
									dismissable="false" widgetVar="panelsearch"
									style="width:360px;">
									<div class="col-md-12"
										style="border: 1px solid #ccc; border-radius: 6px; margin-bottom: 5px !important;">
										<div class="row">
											<div class="col-md-12"
												style="padding-left: 0px !important; padding-right: 0px !important;">
												<label>Khách hàng</label>
												<div class="nhapnpp">
													<span class="fa fa-search"></span>
													<p:autoComplete style="width:100%;"
														placeholder="Tìm khách hàng"
														value="#{contractBean.customerSearch}" queryDelay="900"
														maxResults="200" converter="abstractConverter"
														minQueryLength="2"
														completeMethod="#{contractBean.completeCustomer}" var="p"
														itemLabel="#{p.customer_name}" itemValue="#{p}"
														forceSelection="true" onclick="this.select();">
														<p:column style="width:50px">
															<h:outputText value="#{p.customer_code}" />
														</p:column>
														<p:column style="width:150px">
															<h:outputText value="#{p.customer_name}" />
														</p:column>
													</p:autoComplete>
												</div>
											</div>
										</div>

										<div class="row">
											<div class="col-md-12"
												style="padding-left: 0px !important; padding-right: 0px !important;">
												<label>Số hợp đồng</label>
												<p:inputText value="#{contractBean.voucherCodeSearch}" />
											</div>
										</div>

										<div class="row">
											<div class="col-md-6"
												style="padding-left: 0px !important; padding-right: 5px !important;">
												<label>Từ ngày</label>
												<p:calendar value="#{contractBean.fromDateSearch}"
													pattern="dd/MM/yyyy" showOn="button" mask="99/99/9999"
													showButtonPanel="true" />
											</div>
											<div class="col-md-6"
												style="padding-left: 5px !important; padding-right: 0px !important;">
												<label>Đến ngày</label>
												<p:calendar value="#{contractBean.toDateSearch}"
													pattern="dd/MM/yyyy" showOn="button" mask="99/99/9999"
													showButtonPanel="true" />
											</div>
										</div>
										<div class="row" style="margin-top: 5px; margin-bottom: 10px;">
											<label>Trạng thái thanh lý</label>
											<p:selectOneMenu value="#{contractBean.liquidatedSearch}"
												converter="integerConverter" effect="fade" var="t"
												style="width:100%;">
												<f:selectItem itemLabel="--select--" itemValue="-1" />
												<f:selectItem itemLabel="Đã thanh lý" itemValue="1" />
												<f:selectItem itemLabel="Chưa thanh lý" itemValue="0" />
											</p:selectOneMenu>
										</div>
									</div>
									<div class="col-md-12"
										style="padding-left: 0px !important; padding-right: 0px !important; margin-bottom: 10px;">
										<p:commandLink process="imagePanel"
											update="menuformid:tabview1:tablenc"
											oncomplete="PF('panelsearch').hide()"
											action="#{contractBean.search()}" styleClass="btn_primmary"
											style="margin-left:0px; margin-right:0px;height:29px !important;line-height:29px !important;">
											<i class="fa fa-search" aria-hidden="true"></i>
											<span>Tìm</span>
										</p:commandLink>
									</div>
								</p:overlayPanel>
							</div>
							<div class="row"
								style="margin-top: 5px; margin-bottom: 25px; margin-left: 16px !important; margin-right: 16px !important;">
								<p:dataTable value="#{contractBean.listContract}"
									style="width:100%;" paginatorPosition="bottom"
									styleClass="tablenhapsp" paginator="true" rowKey="#{item.id}"
									id="tablenc" widgetVar="tablenc" rows="50"
									rowsPerPageTemplate="50,100,200"
									selection="#{contractBean.contractSelect}"
									selectionMode="single" resizableColumns="true" var="item">
									<p:ajax event="rowSelect"
										listener="#{contractBean.showContract()}"
										update="menuformid:tabview1:group1" />
									<p:column headerText="Mã hợp đồng" width="45"
										styleClass="textcenter">
										<h:outputText value="#{item.contract_code}" />
									</p:column>
									<p:column headerText="Số chứng từ" width="40"
										styleClass="textcenter">
										<h:outputText value="#{item.voucher_code}" />
									</p:column>
									<p:column headerText="Mã KH" width="40" styleClass="textcenter">
										<h:outputText value="#{item.customer.customer_code}" />
									</p:column>
									<p:column headerText="Khách hàng" width="190">
										<h:outputText style="white-space: initial;"
											value="#{item.customer.customer_name}" />
									</p:column>
									<p:column headerText="Ngày hợp đồng" width="60"
										styleClass="textcenter">
										<h:outputText value="#{item.contract_date}">
											<f:convertDateTime pattern="dd/MM/yyyy" />
										</h:outputText>
									</p:column>
									<p:column headerText="Tiền tệ" width="30"
										styleClass="textcenter">
										<h:outputText value="#{item.currency.currency_type}" />
									</p:column>
									<p:column headerText="Ngày hiệu lực" width="60"
										styleClass="textcenter">
										<h:outputText value="#{item.effective_date}">
											<f:convertDateTime pattern="dd/MM/yyyy" />
										</h:outputText>
									</p:column>
									<p:column headerText="Ngày hết hạn" width="60"
										styleClass="textcenter">
										<h:outputText value="#{item.expiry_date}">
											<f:convertDateTime pattern="dd/MM/yyyy" />
										</h:outputText>
									</p:column>
									<p:column headerText="Trạng thái" width="80"
										styleClass="textcenter">
										<h:outputText
											style="white-space: initial;color:#{item.liquidated ?'#4bac4d' :'red'};"
											value="#{item.liquidated ?  'Đã thanh lý' :'Chưa thanh lý'}" />
									</p:column>
								</p:dataTable>
							</div>
						</div>
						<div class="col-md-12"
							style="padding-left: 0px !important; padding-right: 0px !important;">
						</div>
					</p:tab>
					<p:tab id="tab3" title="Kiểm tra thực hiện hợp đồng">
						<div class="col-md-12"
							style="padding-left: 15px !important; padding-right: 15px !important; padding-bottom: 20px; background-color: #eeeeee;">
							<div class="row" style="margin-top: 18px;">
								<div class="col-md-9"
									style="padding-left: 0px !important; padding-right: 0px !important; margin-bottom: 2px;">
									<p:commandLink update="menuformid:tabview1:tablekt"
										process="@this"
										action="#{contractBean.checkProcessContract()}"
										styleClass="btn_primmary"
										style="margin-left:0px; margin-right:3px; height:29px !important;line-height:29px !important;">
										<i class="fa fa-check-square-o" aria-hidden="true"></i>
										<span>Kiểm tra thực hiện hợp đồng</span>
									</p:commandLink>
								</div>
								<div class="col-md-3"
									style="padding-left: 0px !important; padding-right: 0px !important; text-align: right; margin-bottom: 2px;">
									<div class="btn-group"
										style="height: 30px; margin-right: 5px; display: inline-block !important;">
										<button type="button" class="btn  dropdown-toggle"
											style="background-color: #4bac4d; height: 30px; color: white; font-weight: 600; padding-left: 9px; padding-right: 9px; border-radius: 3px !important; font-size: 11px;"
											data-toggle="dropdown">
											Xuất file<span class="caret"
												style="margin-left: 4px; margin-top: -2px;"></span>
										</button>
										<ul class="dropdown-menu" role="menu">
											<li><p:commandLink process="@this"
													action="#{contractBean.printPDFProcessContract()}">Theo dõi hợp đồng</p:commandLink></li>
											<li><p:commandLink process="@this" ajax="false"
													target="_blank" action="#{contractBean.liquidation()}">Thanh lý hợp đồng</p:commandLink></li>
											<li><p:commandLink process="@this"
													onclick="PF('dlthanhlyhopdong').show();">Thanh lý hợp đồng 2</p:commandLink></li>
										</ul>
									</div>
								</div>
							</div>
							<div class="row" style="margin-bottom: 20px;">
								<p:dataTable value="#{contractBean.listProcessContract}"
									paginatorPosition="bottom" rowsPerPageTemplate="90,180,250"
									styleClass="tablenhapsp" style="width:100%;" paginator="true"
									rowKey="#{item.contract_detail.id}" id="tablekt"
									widgetVar="tablekt" resizableColumns="true" var="item">
									<p:column headerText="Mã SP" width="40" styleClass="textcenter"
										style="background:#{0&gt;item.conlai?'#fedbdb':''}">
										<h:outputText
											value="#{item.contract_detail.product.product_code}" />
									</p:column>
									<p:column headerText="Tên sản phẩm" width="270"
										style="background:#{0&gt;item.conlai?'#fedbdb':''}">
										<h:outputText style="white-space: initial;"
											value="#{item.contract_detail.product.product_name}" />
									</p:column>
									<p:column headerText="ĐVT" width="40" styleClass="textcenter"
										style="background:#{0&gt;item.conlai?'#fedbdb':''}">
										<h:outputText style="white-space: initial;"
											value="#{item.contract_detail.product.unit}" />
									</p:column>
									<p:column headerText="Số lượng HĐ(KG)" width="50"
										styleClass="textright"
										style="background:#{0&gt;item.conlai?'#fedbdb':''}">
										<h:outputText
											value="#{item.contract_detail.quantity*item.contract_detail.product.factor}">
											<f:convertNumber pattern="###,###,##0.#####" />
										</h:outputText>
									</p:column>
									<p:column headerText="Đã thực hiện(KG)" width="50"
										styleClass="textright"
										style="background:#{0&gt;item.conlai?'#fedbdb':''}">
										<h:outputText value="#{item.dathuchien}">
											<f:convertNumber pattern="###,###,##0.#####" />
										</h:outputText>
									</p:column>
									<p:column headerText="Số tiền thực hiện" width="50"
										styleClass="textright"
										style="background:#{0&gt;item.conlai?'#fedbdb':''}">
										<h:outputText value="#{item.tiendathuchien}">
											<f:convertNumber pattern="###,###,##0.#####" />
										</h:outputText>
									</p:column>
									<p:column headerText="Còn lại(KG)" width="50"
										styleClass="textright"
										style="background:#{0&gt;item.conlai?'#fedbdb':''}">
										<h:outputText value="#{item.conlai}">
											<f:convertNumber pattern="###,###,##0.#####" />
										</h:outputText>
									</p:column>
									<p:column headerText="Số tiền còn lại" width="70"
										style="background:#{0&gt;item.conlai?'#fedbdb':''}"
										styleClass="textright">
										<h:outputText value="#{item.tienconlai}">
											<f:convertNumber pattern="###,###,##0.#####" />
										</h:outputText>
									</p:column>
									<p:columnGroup type="footer">
										<p:row>
											<p:column footerText="" />
											<p:column footerText="Tổng cộng" />
											<p:column footerText="" />
											<p:column
												footerText="#{contractBean.formatHandler.getNumberFormat(contractBean.tongsl,1000)}"
												styleClass="textright textbold" />
											<p:column
												footerText="#{contractBean.formatHandler.getNumberFormat(contractBean.tongdathuchien,1000)}"
												styleClass="textright textbold" />
											<p:column
												footerText="#{contractBean.formatHandler.getNumberFormat(contractBean.tongthanhtienTH,1000)}"
												styleClass="textright textbold" />
											<p:column
												footerText="#{contractBean.formatHandler.getNumberFormat(contractBean.tongconlai,1000)}"
												styleClass="textright textbold" />
											<p:column
												footerText="#{contractBean.formatHandler.getNumberFormat(contractBean.tongthanhtienCL,1000)}"
												styleClass="textright textbold" />
										</p:row>
									</p:columnGroup>
								</p:dataTable>
							</div>
						</div>
					</p:tab>
				</p:tabView>
			</h:form>
		</div>
		<p:dialog styleClass="dialogcommon" resizable="false" width="500"
			style="overflow: initial;" closeOnEscape="true"
			header="Chi tiết hợp đồng" widgetVar="dlg1">
			<h:form id="dlg1" style="width:100%;">
				<div class="col-md-12 boxCus">
					<div class="col-md-12"
						style="padding-left: 0px !important; padding-right: 0px !important; margin-top: 5px;">
						<div class="row">
							<label>Sản phẩm</label>
						</div>
						<div class="row">
							<div class="nhapnpp">
								<span class="fa fa-search"></span>
								<p:autoComplete style="width:100%;" placeholder="Tìm sản phẩm"
									value="#{contractBean.contractDetailCrud.product}"
									queryDelay="900" maxResults="200" converter="abstractConverter"
									minQueryLength="2"
									completeMethod="#{contractBean.completeProduct}" var="p"
									itemLabel="#{p.product_name}" itemValue="#{p}"
									forceSelection="true" onclick="this.select();">
									<p:ajax process="@this" event="itemSelect"
										listener="#{contractBean.ajax}" update="dtunit" />
									<p:column style="width:50px">
										<h:outputText value="#{p.product_code}" />
									</p:column>
									<p:column style="width:150px">
										<h:outputText value="#{p.product_name}" />
									</p:column>
									<p:column style="width:50px">
										<h:outputText value="#{p.unit}" />
									</p:column>
								</p:autoComplete>
							</div>
						</div>
					</div>
					<div class="col-md-12"
						style="padding-left: 0px !important; padding-right: 0px !important; margin-top: 5px;">
						<div class="row">
							<label>Đơn vị tính</label>
						</div>
						<div class="row">
							<p:inputText disabled="true" id="dtunit"
								value="#{contractBean.contractDetailCrud.product.unit}" />
						</div>
					</div>
					<div class="col-md-12"
						style="padding-left: 0px !important; padding-right: 0px !important; margin-top: 5px;">
						<div class="row">
							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important;">
								<label>Số lượng</label>
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important;">
								<label>Đơn Giá</label>
							</div>
						</div>
						<div class="row">
							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important;">
								<p:inputNumber
									value="#{contractBean.contractDetailCrud.quantity}"
									styleClass="fix_width100" minValue="0" decimalPlaces="3"
									decimalSeparator="," thousandSeparator=".">
									<p:ajax delay="900" event="keyup" update="thanhtienedit"
										listener="#{contractBean.thanhtien}" />
								</p:inputNumber>
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important;">
								<p:inputNumber
									value="#{contractBean.contractDetailCrud.unit_price}"
									styleClass="fix_width100" minValue="0" decimalPlaces="6"
									decimalSeparator="," thousandSeparator=".">
									<p:ajax delay="900" event="keyup" update="thanhtienedit"
										listener="#{contractBean.thanhtien}" />
								</p:inputNumber>
							</div>
						</div>
					</div>
					<div class="col-md-12"
						style="padding-left: 0px !important; padding-right: 0px !important; margin-top: 5px;">
						<div class="row">
							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important;">
								<label>Thành tiền</label>
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important;">
								<label>Lợi nhuận</label>
							</div>
						</div>
						<div class="row">
							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important;">
								<p:inputNumber value="#{contractBean.contractDetailCrud.total}"
									disabled="true" id="thanhtienedit" styleClass="fix_width100"
									minValue="0" decimalPlaces="2" decimalSeparator=","
									thousandSeparator="." />
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important;">
								<p:inputNumber value="#{contractBean.contractDetailCrud.profit}"
									styleClass="fix_width100" decimalPlaces="3"
									decimalSeparator="," thousandSeparator="." />
							</div>
						</div>
					</div>
					<div class="col-md-12"
						style="padding-left: 0px !important; padding-right: 0px !important; margin-top: 5px; margin-bottom: 5px;">
						<div class="row">
							<p:selectBooleanCheckbox
								style="font-size: 14px !important;color: #b50f0f;"
								value="#{contractBean.contractDetailCrud.promotion}"
								itemLabel="Khuyến mãi" />
						</div>
					</div>
				</div>
				<div class="col-md-12" style="padding: 10px 0px !important;">
					<p:commandLink process="dlg1"
						update="dlg1,messages,menuformid:tabview1:tablect,menuformid:tabview1:tongtien"
						action="#{contractBean.saveOrUpdateDetail()}"
						styleClass="btn_primmary"
						style="margin-left:0px; margin-right:0px;height:29px !important;line-height:29px !important;">
						<i class="fa fa-search" aria-hidden="true"></i>
						<span>Lưu/cập nhật</span>
					</p:commandLink>
				</div>
			</h:form>
		</p:dialog>
		<p:dialog styleClass="dialogcommon" resizable="false" width="500"
			style="overflow: initial;" closeOnEscape="true"
			header="Thanh lý hợp đồng" widgetVar="dlthanhlyhopdong">
			<h:form id="idfthanhlyhopdong" style="width:100%;">
				<div class="col-md-12 boxCus">
					<div class="col-md-12"
						style="padding-left: 0px !important; padding-right: 0px !important; margin-top: 5px;">
						<div class="row">
							<label>Khách hàng</label>
						</div>
						<div class="row">
							<div class="nhapnpp">
								<span class="fa fa-search"></span>
								<p:autoComplete style="width:100%;"
									value="#{contractBean.customerTL}" placeholder="Tìm khách hàng"
									converter="abstractConverter" minQueryLength="2"
									completeMethod="#{contractBean.completeCustomer}" var="p"
									itemLabel="#{p.customer_name}" itemValue="#{p}"
									forceSelection="true" onclick="this.select();">
									<p:column style="width:50px">
										<h:outputText value="#{p.customer_code}" />
									</p:column>
									<p:column style="width:150px">
										<h:outputText value="#{p.customer_name}" />
									</p:column>
								</p:autoComplete>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6"
							style="padding-left: 0px !important; padding-right: 3px !important;">
							<label>Từ ngày</label>
							<p:calendar value="#{contractBean.sDateTL}" pattern="dd/MM/yyyy"
								showOn="button" mask="99/99/9999" showButtonPanel="true" />
						</div>
						<div class="col-md-6"
							style="padding-left: 3px !important; padding-right: 0px !important;">
							<label>Đến ngày</label>
							<p:calendar value="#{contractBean.eDateTL}" pattern="dd/MM/yyyy"
								showOn="button" mask="99/99/9999" showButtonPanel="true" />
						</div>
					</div>
				</div>
				<div class="col-md-12" style="padding: 10px 0px !important;">
					<p:outputLabel
						value="Chương trình bỏ các mã nhập xuất: 'A','P','5','Q','0','O','M','&amp;','+' và bỏ mã loại sản phẩm 'H'" />
				</div>
				<div class="col-md-12" style="padding: 10px 0px !important;">
					<p:commandLink update="messages"
						action="#{contractBean.thanhlyhopdong2()}"
						styleClass="btn_primmary" process="@this" ajax="false"
						target="_blank"
						style="margin-left:0px; margin-right:0px;height:29px !important;line-height:29px !important;">
						<i class="fa fa-search" aria-hidden="true"></i>
						<span>Xuất file(.docx)</span>
					</p:commandLink>
					<p:commandLink styleClass="btn_download" update=":messages"
						ajax="false" target="_blank"
						style="margin-left:5px;background-color: #149d0f !important;"
						title="Xuất excel dữ liệu thô"
						action="#{contractBean.thanhlyhopdong2Excel()}">
						<i class="fa fa-file-excel-o" aria-hidden="true"></i>
						<span>Excel (dữ liệu)</span>
					</p:commandLink>
				</div>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>