<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:h="http://java.sun.com/jsf/html" template="/pages/home.xhtml">
	<ui:define name="content">
		<h3
			style="margin: 0px; color: #00145a; font-weight: bold; font-size: 15px !important; line-height: 13px; padding-top: 10px; padding-left: 10px;">Dự
			báo tồn kho</h3>
		<p:separator />
		<div class="col-md-12">
			<h:form id="menuformid">
				<div class="col-md-12"
					style="padding-left: 0px !important; padding-right: 0px !important; background-color: #eeeeee;">
					<div class="row"
						style="margin-top: 15px; margin-bottom: 25px; margin-left: 16px !important; margin-right: 16px !important;">
						<div class="col-md-12"
							style="padding-left: 0px !important; padding-right: 0px !important;">
							<div class="row">
								<div class="col-md-8">
									<div class="col-md-3">
										<label>Ngày tính tồn</label>
										<p:calendar value="#{expectedInventoryBean.invDate}"
											pattern="dd/MM/yyyy" showOn="button" mask="99/99/9999"
											showButtonPanel="true" />
									</div>
									<div class="col-md-9">
										<p:fieldset id="sedate">
											<div class="col-md-4">
												<label>Từ ngày</label>
												<p:calendar value="#{expectedInventoryBean.expFromDate}"
													pattern="dd/MM/yyyy" showOn="button" mask="99/99/9999"
													showButtonPanel="true" />
											</div>
											<div class="col-md-4">
												<label>Đến ngày</label>
												<p:calendar value="#{expectedInventoryBean.expToDate}"
													pattern="dd/MM/yyyy" showOn="button" mask="99/99/9999"
													showButtonPanel="true" />
											</div>
											<div class="col-md-2">
												<label>Tháng</label>
												<p:spinner value="#{expectedInventoryBean.month}" size="4"
													min="1" max="12">
													<p:ajax listener="#{expectedInventoryBean.ajax_setDate()}"
														update="sedate" process="@this" />
												</p:spinner>
											</div>
											<div class="col-md-2">
												<label>Năm</label>
												<p:spinner value="#{expectedInventoryBean.year}" size="4"
													min="2015" max="2050" thousandSeparator="">
													<p:ajax listener="#{expectedInventoryBean.ajax_setDate()}"
														update="sedate" process="@this" />
												</p:spinner>
											</div>
										</p:fieldset>
									</div>
								</div>
								<div class="col-md-4">
									<p:outputPanel id="idboloc">
										<p:selectBooleanCheckbox
											value="#{expectedInventoryBean.thieuhut}"
											itemLabel="Chỉ xem các sản phẩm thiếu hụt">
											<p:ajax
												listener="#{expectedInventoryBean.ajax_setLocgiatri('thieuhut')}"
												process="@this" update="tablenc,idboloc" />
										</p:selectBooleanCheckbox>
										<p:selectBooleanCheckbox
											value="#{expectedInventoryBean.thieudutru}"
											itemLabel="Chỉ xem các sản phẩm thiếu dự trữ">
											<p:ajax
												listener="#{expectedInventoryBean.ajax_setLocgiatri('thieudutru')}"
												process="@this" update="menuformid" />
										</p:selectBooleanCheckbox>
										<p:selectBooleanCheckbox
											value="#{expectedInventoryBean.xuatdukien}"
											itemLabel="Chỉ xem số lượng xuất dự kiến">
											<p:ajax
												listener="#{expectedInventoryBean.ajax_setLocgiatri('xuatdukien')}"
												process="@this" update="menuformid" />
										</p:selectBooleanCheckbox>
									</p:outputPanel>
								</div>
							</div>

							<div class="row" style="margin-top: 10px;">
								<p:commandLink action="#{expectedInventoryBean.search()}"
									process="menuformid" update="menuformid,idboloc"
									styleClass="btn_primmary">
									<i class="fa fa-search" aria-hidden="true"></i>
									<span>Tìm kiếm</span>
								</p:commandLink>
								<p:commandLink action="#{expectedInventoryBean.exportExcel()}"
									ajax="false" target="_blank" styleClass="btn_download">
									<i class="fa fa-file-excel-o" aria-hidden="true"></i>
									<span>Xuất excel</span>
								</p:commandLink>
								<p:selectBooleanCheckbox
									value="#{expectedInventoryBean.bomaxnnoibo}"
									itemLabel="Bỏ mã KH nội bộ: BL146,CO125" />
							</div>
							<div class="row" style="margin-top: 3px !important;">
								<p:dataTable rendered="#{!expectedInventoryBean.tonghopchinhanh}"
									value="#{expectedInventoryBean.listExpectedInventory}"
									paginatorPosition="bottom" styleClass="tablenhapsp tableright1"
									style="width:100%;" paginator="true" rows="90"
									paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
									currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
									rowsPerPageTemplate="90,120,150,200" id="tablenc"
									widgetVar="tablenc" rowIndexVar="rowe" scrollable="true"
									scrollHeight="500"
									rowStyleClass="#{item.exp_closing_quantity lt  0 ? 'rowwarning' : ''}"
									scrollWidth="" resizableColumns="true" var="item"
									filteredValue="#{expectedInventoryBean.listExpectedInventoryFilter}">
									<p:column
										filterBy="#{expectedInventoryBean.formatHandler.converViToEn(item.product_code)}"
										filterMatchMode="contains" headerText="Mã SP" width="60">
										<h:outputText value="#{item.product_code}" />
									</p:column>
									<p:column
										filterBy="#{expectedInventoryBean.formatHandler.converViToEn(item.product_name)}"
										filterMatchMode="contains" headerText="Sản phẩm" width="300">
										<h:outputText style="white-space: initial;"
											value="#{item.product_name}" />
									</p:column>
									<p:column headerText="Tồn kho" width="70"
										styleClass="textright">
										<h:outputText value="#{item.inv_quantity}">
											<f:convertNumber locale="vi" pattern="###,###,###,##0.00" />
										</h:outputText>
									</p:column>
									<p:column headerText="Dự Xuất" width="70"
										styleClass="textright">
										<p:commandLink
											action="#{expectedInventoryBean.kiemtradonhang(item)}">
											<h:outputText value="#{item.exp_export_quantity}">
												<f:convertNumber locale="vi" pattern="###,###,###,##0.00" />
											</h:outputText>
										</p:commandLink>
									</p:column>
									<p:column headerText="Dự Xuất (XK)" width="70"
										styleClass="textright">
										<h:outputText
											value="#{item.tonghopdong-item.hdhopdongxuatkhau}">
											<f:convertNumber locale="vi" pattern="###,###,###,##0.00" />
										</h:outputText>
									</p:column>
									<p:column headerText="Dự tồn cuối" width="70"
										styleClass="textright">
										<h:outputText value="#{item.exp_closing_quantity}">
											<f:convertNumber locale="vi" pattern="###,###,###,##0.00" />
										</h:outputText>
									</p:column>
									<p:column headerText="Bình quân(30 ngày trc)" width="70"
										styleClass="textright">
										<h:outputText value="#{item.av30_quantity/30}">
											<f:convertNumber locale="vi" pattern="###,###,###,##0.00" />
										</h:outputText>
									</p:column>
								</p:dataTable>
							</div>
							<div class="row" style="margin-top: 10px;">
								<p>
									<span style="color: red; font-weight: bold;">Ghi chú:</span> Từ
									ngày, đến ngày là thời gian để lấy những đơn hàng, khuyến mãi,
									đơn hàng xuất khẩu chưa giao hoặc giao chưa hết để tính số
									lượng dự xuất.
								</p>
								<p style="padding-left: 56px;">Bình quân 30 ngày trước là số
									lượng xuất bình quân mỗi ngày của 30 ngày trước</p>
							</div>
						</div>
					</div>
				</div>
			</h:form>
		</div>
		<p:dialog header="Chi tiết dự báo tồn" widgetVar="dlchitietdubaoton"
			resizable="false" styleClass="dialogcommon"
			style="overflow: initial;width:100%;max-width: min-content;min-width: 800px;">
			<h:form id="idchitietdubaoton">
				<p:dataTable value="#{expectedInventoryBean.chiTietDuBaoTons}"
					styleClass="tablenhapsp tableright1" style="width:100%;"
					rowIndexVar="rowe" paginatorPosition="bottom" paginator="true"
					rows="15" resizableColumns="true" var="item">
					<p:column headerText="Mã đơn hàng" width="80"
						styleClass="textright">
						<h:outputText value="#{item.madonhang}">
						</h:outputText>
					</p:column>
					<p:column headerText="NgàyĐH" width="50" styleClass="textright">
						<h:outputText value="#{item.ngaydh}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					<p:column headerText="NgàyGH" width="50" styleClass="textright">
						<h:outputText value="#{item.ngay}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					<p:column headerText="Khách hàng" width="250"
						style="white-space: initial;">
						<h:outputText value="#{item.tenkhachhang}" />
					</p:column>
					<p:column headerText="Mã SP" width="40">
						<h:outputText value="#{item.product_code}" />
					</p:column>
					<p:column headerText="SLĐH" width="40" styleClass="textright">
						<h:outputText
							value="#{item.sldonhang_thung*item.specification*item.factor}">
							<f:convertNumber locale="vi" pattern="###,###,###,###" />
						</h:outputText>
					</p:column>
					<p:column headerText="SLĐH_xuất" width="50" styleClass="textright">
						<h:outputText
							value="#{item.sldonhangdaxuat_thung*item.specification*item.factor}">
							<f:convertNumber locale="vi" pattern="###,###,###,###" />
						</h:outputText>
					</p:column>
					<p:column headerText="SLKM" width="40" styleClass="textright">
						<h:outputText value="#{slkhuyenmai_dvt*item.factor}">
							<f:convertNumber locale="vi" pattern="###,###,###,###" />
						</h:outputText>
					</p:column>
					<p:column headerText="SLKM_xuất" width="50" styleClass="textright">
						<h:outputText value="#{slkhuyenmaidaxuat_dvt*item.factor}">
							<f:convertNumber locale="vi" pattern="###,###,###,###" />
						</h:outputText>
					</p:column>
					<p:column headerText="SL còn lại" width="50" styleClass="textright">
						<h:outputText
							value="#{((item.sldonhang_thung*item.specification)-(item.sldonhangdaxuat_thung*item.specification)+slkhuyenmai_dvt-slkhuyenmaidaxuat_dvt)*item.factor}">
							<f:convertNumber locale="vi" pattern="###,###,###,###" />
						</h:outputText>
					</p:column>
					<f:facet name="footer">
						<h:outputText value="Tổng cộng: " />
						<h:outputText value="#{expectedInventoryBean.tongsoluongdutru}">
							<f:convertNumber locale="vi" pattern="###,###,###,###" />
						</h:outputText>
						<h:outputText value=" kg " />
					</f:facet>
				</p:dataTable>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>