<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html" template="/pages/home.xhtml">
	<ui:define name="content">
		<h3 class="titleform">Danh mục khách hàng</h3>
		<p:separator />
		<h:form id="menuformid">
			<div class="col-md-12"
				style="padding-left: 0px !important; padding-right: 0px !important;">
				<div class="col-md-12">
					<div class="col-md-12" style="margin-top: 3px;">
						<p:fieldset id="searchform"
							style="margin-bottom:10px;background:#3c8dbc">
							<div class="row">
								<div class="ui-g">
									<div class="ui-md-6 ui-sm-12 ">
										<div class="ui-g">
											<div class="ui-md-8 ui-sm-12 ">
												<div class="nhapdlg">
													<span class="fa fa-search" />
													<p:remoteCommand name="searchEnter"
														actionListener="#{customerBean.search()}" update="tablesp" />
													<p:inputText
														placeholder="Tìm theo mã khách hàng, tên khách hàng, số điện thoại, địa chỉ,.."
														id="inputsearch" style="width:100%;"
														value="#{customerBean.stextStr}"
														onkeypress="if (event.keyCode === 13) { searchEnter(); return false; }">
													</p:inputText>
												</div>
											</div>
											<div class="ui-md-4 ui-sm-12 ">
												<p:commandLink id="idorder" styleClass="btn_primmary"
													immediate="true"
													style="margin-left:5px; margin-right:0px;height:28px !important;line-height:28px !important;">
													<i class="fa fa-search" aria-hidden="true"></i>
													<span>Lọc nâng cao</span>
												</p:commandLink>
											</div>
										</div>
									</div>
									<div class="ui-md-6 ui-sm-12">
										<div style="float: right">
											<p:commandLink styleClass="btn_destroy"
												style="margin-left:1px;height:28px !important;line-height:28px !important;"
												update=":messages,menuformid"
												disabled="#{customerBean.customerCrud==null}"
												action="#{customerBean.delete()}" title="Xóa khách hàng">
												<i class="fa fa-trash" aria-hidden="true"></i>
												<span>Xóa</span>
												<p:confirm icon="ui-icon-alert" />
											</p:commandLink>
											<p:commandLink styleClass="btn_primmary"
												style="margin-left:5px;height:28px !important;line-height:28px !important;"
												update="editdetail" title="Thêm mới khách hàng"
												action="#{customerBean.showDialog()}">
												<i class="fa fa-plus" aria-hidden="true"></i>
												<span>Thêm mới</span>
											</p:commandLink>
											<p:commandLink styleClass="btn_new"
												style="margin-left:5px;height:28px !important;line-height:28px !important;"
												update="editdetail" title="Chỉnh sửa khách hàng"
												action="#{customerBean.showDialogEdit()}">
												<i class="fa fa-pencil" aria-hidden="true"></i>
												<span>Chỉnh sửa</span>
											</p:commandLink>
											<p:commandLink styleClass="btn_printtt"
												style="margin-left:5px;height:28px !important;line-height:28px !important;"
												update="editdetail" onclick="PF('uploadexcelfile').show();">
												<i class="fa fa-file-excel-o" aria-hidden="true"></i>
												<span>Nạp excel</span>
											</p:commandLink>
											<p:commandLink styleClass="btn_printtt"
												style="margin-left:5px;height:28px !important;line-height:28px !important;"
												update="editdetail" process="@this" ajax="false"
												target="blank_" action="#{customerBean.exportExcel()}">
												<i class="fa fa-file-excel-o" aria-hidden="true"></i>
												<span>Xuất excel</span>
											</p:commandLink>
											<p:commandLink styleClass="btn_destroy"
												style="margin-left:1px;height:28px !important;line-height:28px !important;"
												update=":messages,menuformid"
												rendered="#{sessionScope.database eq 'HO CHI MINH'}"
												action="#{customerBean.dongbo()}"
												title="Đồng bộ dữ liệu khách hàng qua chi nhánh (BD)">
												<i class="fa fa-trash" aria-hidden="true"></i>
												<span>Đồng bộ (#{customerBean.dongBo.time})</span>
											</p:commandLink>
											<p:commandLink styleClass="btn_printtt"
												style="margin-left:1px;height:28px !important;line-height:28px !important;"
												update=":messages,menuformid"
												rendered="#{customerBean.account.member.code eq 'admin'}"
												onclick="PF('uploadexcelfilediachi').show();"
												title="Chỉ admin mới cập nhật địa chỉ mới (makh, diachimoi)">
												<i class="fa fa-file-excel-o" aria-hidden="true"></i>
												<span>Cập nhật địa chỉ mới</span>
											</p:commandLink>
										</div>
									</div>
								</div>
							</div>
							<p:overlayPanel id="imagePanel" for="idorder" hideEffect="fade"
								dismissable="false" widgetVar="panelsearch" style="width:360px;">
								<div class="col-md-12"
									style="border: 1px solid #ccc; border-radius: 6px; margin-bottom: 5px !important; padding-bottom: 5px !important;">
									<div class="col-md-12"
										style="padding-top: 10px !important; padding-left: 0px !important; padding-right: 0px !important;">
										<div class="row">
											<div class="col-md-12">
												<label>Loại khách hàng</label>
												<p:autoComplete style="width:100%;"
													value="#{customerBean.customerTypes}" maxResults="20"
													converter="abstractConverter" minQueryLength="3"
													queryDelay="900" dropdown="true"
													completeMethod="#{abstractAutoComplete.completeCustomerTypes}"
													var="p" itemLabel="#{p.name}" itemValue="#{p}"
													forceSelection="true" onclick="this.select();">
													<p:column style="width:20px">
														<h:outputText value="#{p.id}" />
													</p:column>
													<p:column style="width:50px">
														<h:outputText value="#{p.code}" />
													</p:column>
													<p:column style="width:150px">
														<h:outputText value="#{p.name}" />
													</p:column>
												</p:autoComplete>
											</div>
											<div class="col-md-12">
												<label>Tỉnh/thành phố</label>
												<div class="nhapdlg">
													<span class="fa fa-search"></span>
													<p:autoComplete style="width:100%;"
														value="#{customerBean.city}" maxResults="50"
														converter="abstractConverter" minQueryLength="3"
														queryDelay="900" dropdown="true"
														completeMethod="#{abstractAutoComplete.completeCity}"
														var="p" itemLabel="#{p.city_name}" itemValue="#{p}"
														forceSelection="true" onclick="this.select();">
														<p:column style="width:20px">
															<h:outputText value="#{p.id}" />
														</p:column>
														<p:column style="width:50px">
															<h:outputText value="#{p.city_code}" />
														</p:column>
														<p:column style="width:150px">
															<h:outputText value="#{p.city_name}" />
														</p:column>
													</p:autoComplete>
												</div>
											</div>

										</div>
									</div>
								</div>
								<div class="col-md-12"
									style="padding-left: 0px !important; padding-right: 0px !important; margin-bottom: 5px;">
									<div class="pull-right">
										<p:commandButton value="Lọc" process="imagePanel"
											icon="ui-icon-search" oncomplete="PF('panelsearch').hide()"
											actionListener="#{customerBean.search()}" update="tablesp" />
									</div>
								</div>
							</p:overlayPanel>
						</p:fieldset>
						<p:sticky target="searchform" />
						<p:dataTable value="#{customerBean.listCustomer}"
							paginatorPosition="bottom" styleClass="tablenhapsp tableright1"
							paginator="true" rowKey="#{item.id}" id="tablesp"
							style="width:100%;" rows="50" rowsPerPageTemplate="50,100,200"
							selection="#{customerBean.customerSelect}" selectionMode="single"
							resizableColumns="true" var="item">
							<p:ajax event="rowDblselect"
								listener="#{customerBean.showDialogEdit()}" update="editdetail" />
							<p:column headerText="ID" width="30" styleClass="textcenter">
								<h:outputText value="#{item.id}" />
							</p:column>
							<p:column headerText="Mã KH" width="30">
								<h:outputText value="#{item.customer_code}" />
							</p:column>
							<p:column headerText="Tên khách hàng" width="250">
								<h:outputText style="white-space: initial;"
									value="#{item.customer_name}" />
							</p:column>
							<p:column headerText="Đơn vị" width="250">
								<h:outputText style="white-space: initial;"
									value="#{item.company_name}" />
							</p:column>
							<p:column headerText="Địa chỉ" width="250">
								<h:outputText value="#{item.address}"
									style="white-space: initial;" />
							</p:column>
							<p:column headerText="ĐT" width="50">
								<h:outputText value="#{item.cell_phone }" />
							</p:column>
							<p:column headerText="ĐT bàn" width="50">
								<h:outputText value="#{item.home_phone}" />
							</p:column>
							<p:column headerText="Fax" width="50">
								<h:outputText value="#{item.fax}" />
							</p:column>
							<p:column headerText="Mã số thuế" width="70">
								<h:outputText value="#{item.tax_code}" />
							</p:column>
							<p:column headerText="Email" width="120">
								<h:outputText value="#{item.email}"
									style="white-space: initial;" />
							</p:column>
							<p:column headerText="Loại khách hàng" width="150">
								<h:outputText value="#{item.customer_types.name}"
									style="white-space: initial;" />
							</p:column>
							<p:column headerText="Định danh cá nhân" width="150">
								<h:outputText value="#{item.citizenIDNumber}"
									style="white-space: initial;" />
							</p:column>
							<p:column headerText="Địa chỉ cũ" width="250">
								<h:outputText value="#{item.addressOld}"
									style="white-space: initial;" />
							</p:column>
						</p:dataTable>
					</div>
				</div>
			</div>
		</h:form>
		<p:dialog styleClass="dialogcommon" resizable="false" width="940"
			style="overflow: initial;" closeOnEscape="true"
			header="Chi tiết khách hàng" widgetVar="dlg1">
			<h:form id="editdetail" style="width:100%;">
				<div class="col-md-12 boxCus">
					<div class="col-md-6">
						<div class="row">
							<div class="col-md-3"
								style="padding-left: 0px !important; padding-right: 5px !important;">
								<label>Mã KH(tự động)<span style="color: red;">*</span></label>
								<p:inputText value="#{customerBean.customerCrud.customer_code}" />
							</div>
							<div class="col-md-9"
								style="padding-left: 5px !important; padding-right: 0px !important;">
								<label>Tên khách hàng<span style="color: red;">*</span></label>
								<p:inputText value="#{customerBean.customerCrud.customer_name}" />
							</div>
							<div class="col-md-12"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Tên người mua hàng</label>
								<p:inputText value="#{customerBean.customerCrud.nguoi_mua_hang}" />
							</div>
							<div class="col-md-12"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Số định danh cá nhân(tối đa 12 ký tự dạng số)</label>
								<p:inputText maxlength="12"
									value="#{customerBean.customerCrud.citizenIDNumber}" />
							</div>
							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Đơn vị</label>
								<p:inputText value="#{customerBean.customerCrud.company_name}" />
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important; margin-top: 5px;">
								<label>Loại khách hàng<span style="color: red;">*</span></label>
								<p:selectOneMenu
									value="#{customerBean.customerCrud.customer_types}"
									converter="abstractConverter" effect="fade" var="t"
									style="width:100%;" filter="true" filterMatchMode="custom"
									filterFunction="utility.customFilter">
									<f:selectItem value="#{null}" itemLabel="--select--" />
									<f:selectItems value="#{customerBean.listCustomerTypes}"
										var="it" itemLabel="#{it.name}" itemValue="#{it}" />
									<p:column>
										<h:outputText value="#{t != null ? t.name : '--select--' }" />
									</p:column>
								</p:selectOneMenu>
							</div>

							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Điện thoại di động</label>
								<p:inputText value="#{customerBean.customerCrud.cell_phone}" />
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important; margin-top: 5px;">
								<label>Điện thoại bàn</label>
								<p:inputText value="#{customerBean.customerCrud.home_phone}" />
							</div>

							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Email<i
									title="Lưu ý: Email không được có khoảng trống;Nếu nhiều địa chỉ email thì các email được viết liền nhau cách nhau bằng dấu chấm phẩy."
									class="fa fa-question-circle" aria-hidden="true"></i></label>
								<p:inputText value="#{customerBean.customerCrud.email}" />
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important; margin-top: 5px;">
								<label>Fax</label>
								<p:inputText value="#{customerBean.customerCrud.fax}" />
							</div>

							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Thành phố</label>
								<p:autoComplete style="width:100%;"
									value="#{customerBean.customerCrud.city}"
									converter="abstractConverter" minQueryLength="2"
									completeMethod="#{customerBean.completeCity}" var="p"
									itemLabel="#{p.city_name}" itemValue="#{p}"
									forceSelection="true" onclick="this.select();">
									<p:column style="width:50px">
										<h:outputText value="#{p.city_code}" />
									</p:column>
									<p:column style="width:150px">
										<h:outputText value="#{p.city_name}" />
									</p:column>
								</p:autoComplete>
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important; margin-top: 5px;">
								<div class="col-md-6"
									style="padding-left: 0px !important; padding-right: 0px !important; margin-top: 5px;">
									<label>Mã số thuế<i
										title="Lưu ý: Mã số thuế không được có khoảng trống"
										class="fa fa-question-circle" aria-hidden="true"></i></label>
									<p:inputText value="#{customerBean.customerCrud.tax_code}" />
								</div>
								<div class="col-md-6"
									style="padding-left: 0px !important; padding-right: 0px !important; margin-top: 5px;">
									<label>Số tài khoản</label>
									<p:inputText
										value="#{customerBean.customerCrud.bank_account_no}" />
								</div>
							</div>
							<div class="col-md-12"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Địa chỉ</label>
								<p:inputTextarea value="#{customerBean.customerCrud.address}"
									rows="2" />
							</div>
							<div class="col-md-12"
								style="padding-left: 5px !important; padding-right: 0px !important; margin-top: 5px;">
								<label>Địa chỉ giao hàng</label>
								<p:inputTextarea
									value="#{customerBean.customerCrud.location_delivery}" rows="2" />
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="row">
							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Mã số NCC</label>
								<p:inputText value="#{customerBean.customerCrud.supplier_code}" />
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important; margin-top: 5px;">
								<label>Số ngày nợ</label>
								<p:inputNumber
									value="#{customerBean.customerCrud.days_debt_quantity}"
									styleClass="fix_width100" minValue="0" decimalPlaces="3"
									decimalSeparator="," thousandSeparator="." />
							</div>

							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Tỉ lệ khuyến khích ttsp TPHCM</label>
								<p:inputNumber
									value="#{customerBean.customerCrud.encourage_rate}"
									styleClass="fix_width100" minValue="0" decimalPlaces="3"
									decimalSeparator="," thousandSeparator="." />
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important; margin-top: 5px;">
								<label>Tỉ lệ hoa hồng bột giặt</label>
								<p:inputNumber
									value="#{customerBean.customerCrud.commission_value}"
									styleClass="fix_width100" minValue="0" decimalPlaces="3"
									decimalSeparator="," thousandSeparator="." />
							</div>

							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Tỉ lệ hoa hồng NTRL</label>
								<p:inputNumber
									value="#{customerBean.customerCrud.commission_ntrl_value}"
									styleClass="fix_width100" minValue="0" decimalPlaces="3"
									decimalSeparator="." thousandSeparator="." />
							</div>
							<div class="col-md-6"
								style="padding-left: 5px !important; padding-right: 0px !important; margin-top: 5px;">
								<label>Số tiền NPP chuyển</label>
								<p:inputNumber value="#{customerBean.customerCrud.amount_npp}"
									styleClass="fix_width100" minValue="0" decimalPlaces="3"
									decimalSeparator="," thousandSeparator="." />
							</div>
							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 0px !important; margin-bottom: 5px; margin-top: 10px;">
								<p:selectBooleanCheckbox style="color:#0a144d;"
									value="#{customerBean.customerCrud.disable}"
									itemLabel="Khách hàng không còn bán" />
							</div>
							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 0px !important; margin-bottom: 5px; margin-top: 10px;">
								<p:selectBooleanCheckbox style="color:#0a144d;"
									value="#{customerBean.customerCrud.not_print_customer_name}"
									itemLabel="Không in tên khách hàng trên hóa đơn" />
							</div>
							<div class="col-md-6"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Mã XN mặc định</label>
								<p:inputText value="#{customerBean.customerCrud.maxn}" />
							</div>
							<div class="col-md-12"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Ghi chú</label>
								<p:inputTextarea value="#{customerBean.customerCrud.ghichu}"
									rows="3" />
							</div>
							<div class="col-md-12"
								style="padding-left: 0px !important; padding-right: 5px !important; margin-top: 5px;">
								<label>Địa chỉ cũ</label>
								<p:inputTextarea
									value="#{customerBean.customerCrud.addressOld}" rows="2" />
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-12" style="padding: 10px 0px;">
					<p:commandButton id="idorder" icon="fa fa-floppy-o"
						style="padding:4px !important;"
						actionListener="#{customerBean.saveOrUpdate()}"
						styleClass="buttonaddrow"
						update=":messages,menuformid:tablesp,editdetail"
						value="Lưu/Cập nhật" />
				</div>
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="uploadexcelfile" resizable="false"
			style="overflow: initial;width:100%;max-width: min-content;min-width: 384px;"
			styleClass="dialogcommon" header="Tải File">
			<h:form id="mm" enctype="multipart/form-data">
				<div class="col-md-12"
					style="padding-left: 0px !important; padding-right: 0px !important;">
					<div class="col-md-12">
						<div class="row">
							<p:fileUpload style="width: max-content;" dragDropSupport="true"
								allowTypes="/(\.|\/)(xls|xlsx)$/" label="Chọn file"
								cancelLabel="Huỷ" update=":messages,menuformid:tablesp"
								uploadLabel="Tải lên" multiple="false"
								listener="#{customerBean.loadExcel}" mode="advanced" />
						</div>
					</div>
					<div class="col-md-12" style="margin-bottom: 10px;">
						<div class="row">
							<div class="col-md-6">
								<a
									href="#{request.contextPath}/resources/upload/filemau/file_mau_khach_hang.xlsx"
									style="color: #0077b3; text-decoration: underline;">Xem
									file excel mẫu</a>
							</div>
						</div>
					</div>
				</div>
			</h:form>
		</p:dialog>
		<p:dialog widgetVar="uploadexcelfilediachi" resizable="false"
			style="overflow: initial;width:100%;max-width: min-content;min-width: 384px;"
			styleClass="dialogcommon" header="Cập nhật địa chỉ mới">
			<h:form enctype="multipart/form-data">
				<div class="col-md-12"
					style="padding-left: 0px !important; padding-right: 0px !important;">
					<div class="col-md-12">
						<div class="row">
							<p:fileUpload style="width: max-content;" dragDropSupport="true"
								allowTypes="/(\.|\/)(xls|xlsx)$/" label="Chọn file"
								cancelLabel="Huỷ" update=":messages,menuformid:tablesp"
								uploadLabel="Tải lên" multiple="false"
								listener="#{customerBean.loadExcelDiaChi}" mode="advanced" />
						</div>
					</div>
					<div class="col-md-12" style="margin-bottom: 10px;">
						<div class="row">
							<div class="col-md-6">
								<a href="#" style="color: #0077b3; text-decoration: underline;">Mẫu
									file (mã khách hàng, địa chỉ mới)</a>
							</div>
						</div>
					</div>
				</div>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>