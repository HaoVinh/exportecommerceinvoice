<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:h="http://java.sun.com/jsf/html" template="/pages/home.xhtml">
	<ui:define name="content">
		<h3 style="margin: 0px;color: #00145a;font-weight: bold;font-size: 15px !important;line-height: 13px;padding-top: 10px;padding-left: 10px;">Xuất hàng</h3>
		<p:separator />
	<div class="col-md-12" >
		<h:form id="menuformid">
		        <span style="position: absolute;right: 15px;top: 10px;z-index: 1;">
		            <p:commandLink title="Prev" update="menuformid:tabview1:tab2real,menuformid:tabview1:tongthue,menuformid:tabview1:tongtien" styleClass="btnexportpos" action="#{invoiceStockerBean.nextOrPrev(0)}" style="margin-right:2px;"  >
				      <i class="fa fa-caret-left" aria-hidden="true"></i>
				   </p:commandLink>
			        <p:commandLink title="Prev" update="menuformid:tabview1:tab2real,menuformid:tabview1:tongthue,menuformid:tabview1:tongtien" styleClass="btnexportpos" action="#{invoiceStockerBean.nextOrPrev(1)}">
				      <i class="fa fa-caret-right" aria-hidden="true"></i>
				   </p:commandLink>
		        </span>
		       <p:tabView id="tabview1" styleClass="clearfix label12 tabview_lix">
		       <p:tab id="tab2"  title="Chi tiết hóa đơn" >
		           <h:panelGroup id="tab2real" styleClass="clearfix" style="background-color: #eeeeee;width: 100%;height: auto;padding-top: 13px;padding-right: 10px;display: inline-block;padding-left: 10px;padding-bottom: 20px;">
		               <div class="wrapdetail" style="background-color: #eeeeee;width: 100%;height: auto;">
		               <div class="col-md-12" style=" padding-left: 0px !important;padding-right:0px !important;background-color:white;padding-top: 15px;">
		               <div class="col-md-12" style=" padding-left: 0px !important;padding-right:0px !important;">
		                   <div class="row">
		                      <div class="col-md-3">
		                         <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                            <label>Số chứng từ<span style="color:red;">*</span></label>
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                               <label>Mã hóa đơn<span style="color:red;">*</span></label>
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                          <label>HT thanh toán</label>
		                      </div>
		                      <div class="col-md-3">
		                          <label>Loại nhập xuất<span style="color:red;">*</span></label>
		                      </div>
		                      <div class="col-md-3">
		                          <label>Người tạo<span style="color:red;">*</span></label>
		                      </div>
		                   </div>
		                   <div class="row">
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                             <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.voucher_code}" style="width:100%;" />
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                               <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.invoice_code}" style="width:100%;" />
		                          </div>
		                         
		                      </div>
		                      <div class="col-md-3">
		                           <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.payment_method.method_name}" style="width:100%;" />
		                      </div>
		                      <div class="col-md-3">
		                          <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.ie_categories.content}" style="width:100%;" />
		                      </div>
		                      <div class="col-md-3">
		                           <div class="usernhapsp">
							         <span class="fa fa-user-circle-o"></span>
		                             <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.created_by}" style="width:100%;" />
		                           </div>
		                      </div>
		                   </div>
		               </div>
		               <div class="col-md-12" style="margin-top: 5px; padding-left: 0px !important;padding-right:0px !important;">
		                   <div class="row">
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                            <label>Đơn hàng<span style="color:red;">*</span></label>
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                               <label>Số đơn hàng</label>
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                             <label>Số xe</label>
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                               <label>Tỉ lệ thuế</label>
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                          <label>Kho<span style="color:red;">*</span></label>
		                      </div>
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                            <label>Số LĐĐ</label>
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                               <label>P/O</label>
		                          </div>
		                      </div>
		                      
		                   </div>
		                   <div class="row">
		                      <div class="col-md-3">
		                           <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                               <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.order_code}" />
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                               <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.order_voucher}" />
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                             <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.car.license_plate}" style="width:100%;" />
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                                <p:inputNumber readonly="true"   onclick="this.select()" value="#{invoiceStockerBean.invoiceCrud.tax_value}" styleClass="intputnumcc" style="width:100%;"
											minValue="0" decimalPlaces="4" decimalSeparator="," maxValue="1000000" emptyValue="0"
					                 thousandSeparator="." />
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                           <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.warehouse.name}" style="width:100%;" />
		                      </div>
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                              <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.movement_commands_no}" style="width:100%;" />
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                                <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.po_no}" style="width:100%;" />
		                          </div>
			                    </div>
		                   </div>
		               </div>
		               <div class="col-md-12" style="margin-top: 5px; padding-left: 0px !important;padding-right:0px !important;">
		                   <div class="row">
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                            <label>CT.Đơn giá</label>
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                               <label>CT.Khuyến mãi</label>
		                          </div>
		                      </div>
		                       <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                            <label>Tỉ lệ CK</label>
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                               <label>Số HĐVCNB</label>
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                            <label>Số HĐMB</label>
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                               <label>Số SerieHD</label>
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                              <label>Hình thức lên hàng</label>
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                              <label>t/g lên hàng(phút)</label>
		                          </div>
		                      </div>
		                   </div>
		                   <div class="row">
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                              <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.pricing_program.program_code}" style="width:100%;" />
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                             <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.promotion_program.program_code}" style="width:100%;" />
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                               <p:inputNumber readonly="true"  onclick="this.select()" value="#{invoiceStockerBean.invoiceCrud.discount}" styleClass="intputnumcc" style="width:100%;"
											minValue="0" decimalPlaces="4" decimalSeparator="," maxValue="1000000" emptyValue="0"
					                 thousandSeparator="." />
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                              <p:inputText  readonly="true"  value="#{invoiceStockerBean.invoiceCrud.freight_contract.contract_code}" style="width:100%;" />
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                             <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.contract.contract_code}" style="width:100%;" />
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                              <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.invoice_serie}" style="width:100%;" />
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                              <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.form_up_goods.content}" style="width:100%;" />
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                              <p:inputNumber  readonly="true"  onclick="this.select()" value="#{invoiceStockerBean.invoiceCrud.time_up_goods}" styleClass="intputnumcc" style="width:100%;"
										minValue="0" decimalPlaces="0" decimalSeparator="," maxValue="1000000" emptyValue="0"
				                 thousandSeparator="." />
		                          </div>
		                      </div>
		                      
		                   </div>
		               </div>
		               <div class="col-md-12" style="margin-top: 5px; padding-left: 0px !important;padding-right:0px !important;">
		                   <div class="row">
		                      <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                             <label>Ngày hóa đơn<span style="color:red;">*</span></label>
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                               <label>Ngày giao hàng</label>
		                          </div>
		                      </div>
		                      <div class="col-md-3">
		                          <label>Thủ kho</label>
		                      </div>
		                      <div class="col-md-3">
		                          <label>Bốc xếp</label>
		                      </div>
		                      <div class="col-md-3">
		                          <label>Cảng đến</label>
		                      </div>
		                   </div>
		                   <div class="row">
		                        <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left:0px !important; padding-right:3px !important;">
		                              <p:calendar readonly="true" disabled="true" value="#{invoiceStockerBean.invoiceCrud.invoice_date}" pattern="dd/MM/yyyy"  mask="99/99/9999"  />
		                          </div>
		                          <div class="col-md-6" style="padding-left:3px !important; padding-right:0px !important;">
		                              <p:calendar readonly="true" onclick="return false;" value="#{invoiceStockerBean.invoiceCrud.delivery_date}" pattern="dd/MM/yyyy"  mask="99/99/9999"  />
		                          </div>
		                        </div>
		                         <div class="col-md-3">
		                           <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.stocker.stocker_name}" style="width:100%;" />
		                         </div>
			                      <div class="col-md-3">
			                           <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.stevedore.content}" style="width:100%;" />
			                      </div>
			                      <div class="col-md-3">
			                          <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.harbor_category.harbor_name}" style="width:100%;" />
			                      </div>
		                   </div>
		               </div>
		               <div class="col-md-12" style="margin-top: 5px; padding-left: 0px !important;padding-right:0px !important;">
		                   <div class="row">
		                      <div class="col-md-3">
		                          <label>Khách hàng<span style="color:red;">*</span></label>
		                      </div>
		                      <div class="col-md-3">
		                          <label>Ghi chú</label>
		                      </div>
		                      <div class="col-md-3">
		                         <label>Người vận chuyển</label>
		                      </div>
		                     <div class="col-md-3">
		                          <div class="col-md-6" style="padding-left: 0px !important; padding-right:5px !important;">
		                               <label>ID hóa đơn điện tử</label>
		                          </div>
		                          <div class="col-md-6" style="padding-left: 5px !important; padding-right:0px !important;">
		                               <label>Mã tra cứu</label>
		                          </div>
		                      </div>
		                   </div>
		                   <div class="row">
		                         <div class="col-md-3">
		                             <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.customer.customer_name}" style="width:100%;" />
		                         </div>
			                      <div class="col-md-3">
			                          <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.note}" style="width:100%;" />
			                      </div>
			                      <div class="col-md-3">
			                          <p:inputText readonly="true" value="#{invoiceStockerBean.invoiceCrud.carrier.carrier_name}" style="width:100%;" />
			                      </div>
			                      <div class="col-md-3">
			                          <div class="col-md-6" style="padding-left: 0px !important; padding-right:5px !important;">
		                                   <p:inputText readonly="true" value="#{(invoiceStockerBean.invoiceCrud.refId==null or ''.equals(invoiceStockerBean.invoiceCrud.refId)) ? invoiceStockerBean.invoiceCrud.refIdVCNB :invoiceStockerBean.invoiceCrud.refId}" />
			                          </div>
			                          <div class="col-md-6" style="padding-left: 5px !important; padding-right:0px !important;">
			                                <p:inputText readonly="true" value="#{(invoiceStockerBean.invoiceCrud.lookup_code==null or ''.equals(invoiceStockerBean.invoiceCrud.lookup_code)) ? invoiceStockerBean.invoiceCrud.lookup_code_vcnb : invoiceStockerBean.invoiceCrud.lookup_code}" />
			                          </div>
			                      </div>
		                   </div>
		               </div>
		               <div class="col-md-12" style="margin-top: 5px; padding-left: 0px !important;padding-right:0px !important;">
		                   <div class="row">
		                      <div class="col-md-3">
		                          <label>Lưu ý KH</label>
		                      </div>
		                      <div class="col-md-3">
		                          <label>Nơi đến</label>
		                      </div>
		                      <div class="col-md-3">
		                          <label>Nội dung vận chuyển</label>
		                      </div>
		                      <div class="col-md-3">
		                          
		                      </div>
		                   </div>
		                   <div class="row">
		                         <div class="col-md-3">
			                            <p:inputTextarea readonly="true" styleClass="textareap" value="#{invoiceStockerBean.invoiceCrud.customer.note}" rows="2">
			                          </p:inputTextarea>
		                         </div>
			                      <div class="col-md-3">
			                           <p:inputTextarea readonly="true" styleClass="textareap" value="#{invoiceStockerBean.invoiceCrud.delivery_pricing.address}" rows="2">
			                          </p:inputTextarea>
			                      </div>
			                      <div class="col-md-3">
			                          <p:inputTextarea readonly="true"  styleClass="textareap" value="#{invoiceStockerBean.invoiceCrud.transport_content}" rows="2">
			                          </p:inputTextarea>
			                      </div>
			                      <div class="col-md-3">
			                           <div style="border: 1px solid #009a8b;padding-top: 15px;padding-bottom:4px; text-align: center;height:48px;">
				                            <p:selectBooleanCheckbox disabled="true"  itemLabel="Đã thanh toán" value="#{invoiceStockerBean.invoiceCrud.payment}" />
				                            <p:selectBooleanCheckbox disabled="true" itemLabel="Ngoài giờ" value="#{invoiceStockerBean.invoiceCrud.timeout}" />
			                            </div>
			                      </div>
		                   </div>
		               </div>
		               <div class="col-md-12" style="margin-top: 18px; padding-left: 0px !important;padding-right:0px !important;">
		                   <div class="row">
		                      <div class="col-md-3" style="padding-right:5px !important;">
		                         <p:fieldset legend="#{invoiceStockerBean.invoiceCrud.ipromotion==true ? 'Hóa đơn khuyến mãi' :'Hóa đơn chính'}" 
							          styleClass="fieldsetclass2 label12 classfixtopfieldset">
							          <span style="color:red;display:#{invoiceStockerBean.invoiceCrud.exported==false ? 'inline-block' :'none'}">Chưa xuất hàng</span>
							          <span style="color:#03A9F4;display:#{invoiceStockerBean.invoiceCrud.exported==true ? 'inline-block' :'none'}">Đã xuất hàng</span>
							      </p:fieldset>
							  </div>
		                      <div class="col-md-3" style="padding-right:5px !important;">
		                          <div class="col-md-6" style="padding-left: 0px !important; padding-right:5px !important;">
	                                   <p:fieldset id="tongthue" legend="Tiền thuế" 
							          styleClass="fieldsetclass2 label12 classfixtopfieldset">
								          <span> #{invoiceStockerBean.formatHandler.getNumberFormat(invoiceStockerBean.sumInvoice()*invoiceStockerBean.invoiceCrud.tax_value,1000)}</span>
								      </p:fieldset>
		                          </div>
		                          <div class="col-md-6" style="padding-left: 5px !important; padding-right:0px !important;">
		                               <p:fieldset id="tongtien" legend="Tổng tiền" 
								          styleClass="fieldsetclass2 label12 classfixtopfieldset">
								          <span>#{invoiceStockerBean.formatHandler.getNumberFormat(invoiceStockerBean.sumInvoice(),1000)}</span>
								      </p:fieldset>
		                          </div>
							  </div>
							  <div class="col-md-6 lmenu" style="padding-right:5px !important;">
		                          <div class="row" style="margin-top: 0px;margin-bottom: 7px;">
		                              <div style="float:right;">
		                                   <span class="" style="margin-left:5px !important;margin-right:5px !important; display: inline-block;">
										        <p:selectBooleanCheckbox value="#{invoiceStockerBean.invoiceCrud.exported}" styleClass="checkboxbtnspec" itemLabel="Đã xuất xong"  >
										           <p:ajax event="change" listener="#{invoiceStockerBean.processExported()}" update="tab2real" />
										    	</p:selectBooleanCheckbox>
							    	       </span>
								    	   <p:commandLink update="tab2real"   action="#{invoiceStockerBean.viewInventory()}" styleClass="btn_primmary" style="margin-left:5px; " >
							                    <i class="fa fa-eye" aria-hidden="true"></i><span>Xem tồn kho</span>
							              </p:commandLink>
							              <p:commandLink process="@this"  action="#{invoiceStockerBean.showDialogPrint()}" styleClass="btn_printtt" style="margin-left:5px; padding-left:12px;padding-right:12px;" >
							                    <i class="fa fa-print" aria-hidden="true"></i><span>Xuất file</span>
							              </p:commandLink>
						               </div>
				                   </div>
				                   <div class="row" style="margin-bottom: 3px;">
				                       <div class="col-md-12">
				                       </div>
				                   </div>
		                      </div>
		                      
		                   </div>
		               </div>
		               </div>
		               </div>
		               <div class="col-md-12" style="margin-top: 10px; padding-left: 0px !important;padding-right:0px !important; background-color: white;     padding-top: 10px;">
		                   <div class="row">
							    <div class="col-md-12">
							      <div class="row">
							        
								  </div>
							   </div>
							   <div class="col-md-12">
							       <div class="row">
								       <p:dataTable value="#{invoiceStockerBean.listWrapInvoiceDetail}" 
										paginatorPosition="bottom" rowsPerPageTemplate="90,180,250"  
										paginator="true" rowKey="#{item.invoice_detail.id}" style="width:100%;" styleClass="tablenhapsp tableright1"
										selection="#{invoiceStockerBean.wrapInvoiceDetailSelect}" scrollable="true" 
										selectionMode="single" scrollWidth="" id="tablect" filteredValue="#{invoiceStockerBean.listWrapInvoiceDetailFilter}"
										scrollHeight="370" widgetVar="tablect"  expandedRow="false"
										var="item">
										<p:column width="20" styleClass="textcenter">
								            <p:rowToggler   />
								        </p:column>
								        <p:column width="30" styleClass="textcenter">
										   <p:commandLink title="Xuất lô hàng" update="dlgexport,dlgheader" styleClass="btnexportpos" action="#{invoiceStockerBean.showDialogExport(item)}">
										      <i class="fa fa-external-link" aria-hidden="true"></i>
										   </p:commandLink>
										</p:column>
										<p:column headerText="ID" width="30">
											<h:outputText value="#{item.invoice_detail.id}" />
										</p:column>
										<p:column headerText="Mã SP" width="50"   styleClass="fixtoggel" filterBy="#{invoiceStockerBean.formatHandler.converViToEn(item.invoice_detail.product.product_code)}" filterMatchMode="contains">
											<h:outputText value="#{item.invoice_detail.product.product_code}" />
										</p:column>
										<p:column headerText="Sản phẩm" styleClass="fixtoggel" width="300" filterBy="#{invoiceStockerBean.formatHandler.converViToEn(item.invoice_detail.product.product_name)}" filterMatchMode="contains">
														<h:outputText style="white-space: initial;"
															value="#{item.invoice_detail.product.product_name}" />
													</p:column>
										<p:column style="color: #0c0c4c;font-weight: bold;" headerText="Tồn kho" width="40" styleClass="textright">
											<h:outputText value="#{invoiceStockerBean.formatHandler.getNumberFormat(item.inv_quantity,1000)}" />
										</p:column>
										<p:column style="color: #0c0c4c;font-weight: bold;" headerText="Dự báo tồn" width="45" styleClass="textright">
											<h:outputText value="#{invoiceStockerBean.formatHandler.getNumberFormat(item.inv_quantity_cal,1000)}" />
										</p:column>
										<p:column headerText="Số lượng" width="50" styleClass="textright">
											<h:outputText value="#{invoiceStockerBean.formatHandler.getNumberFormat(item.invoice_detail.quantity,1000)}" />
										</p:column>
										<p:column headerText="Thực xuất" width="65" styleClass="textright">
											<h:outputText id="realExport" style="color:#ed5c6a;font-weight: bold;" value="#{invoiceStockerBean.formatHandler.getNumberFormat(item.invoice_detail.real_quantity,1)}" />
										</p:column>
										<p:column headerText="Qui cách" width="80">
											<h:outputText value="#{invoiceStockerBean.formatHandler.getNumberFormat(item.invoice_detail.product.specification,1000)} #{item.invoice_detail.product.unit}/#{item.invoice_detail.product.packing_unit}" />
										</p:column>
										<p:column headerText="Maspdh" width="50">
											<h:outputText value="#{item.invoice_detail.productdh_code}" />
										</p:column>
										<p:rowExpansion styleClass="parentPosition" >
										   <p:dataTable value="#{item.list_export_batch}" style=" width:75%; min-height:100px !important; font-size:11px !important;"
												paginatorPosition="bottom" rowsPerPageTemplate="90,180,250" 
												 styleClass="tableinner" 
												paginator="true" rowKey="#{item2.id}"   id="tableInner"
												 widgetVar="tableInner" 
												var="item2">
												<p:column width="5" styleClass="textcenter">
												    <p:commandLink update="tableInner,messages" styleClass="trash_del" style="font-size:15px !important;" process="@this" action="#{invoiceStockerBean.deleteExportBatch(item2,item.list_export_batch)}">
													   <span class="fa fa-trash-o"></span>
													</p:commandLink>
												</p:column>
												<p:column headerText="ID" width="15" styleClass="textcenter">
													<h:outputText  value="#{item2.id}" />
												</p:column>
												<p:column headerText="Ngày sản xuất" width="90" styleClass="textcenter">
													<h:outputText  value="#{item2.batch.manufacture_date}">
													   <f:convertDateTime pattern="dd/MM/yyyy"/>
													</h:outputText>
												</p:column>
												<p:column headerText="Mã lô hàng" width="40" styleClass="textcenter">
													<h:outputText value="#{item2.batch.batch_code}" />
												</p:column>
												<p:column headerText="Số lượng xuất" width="40" styleClass="textright">
												     <h:outputText value="#{invoiceStockerBean.formatHandler.getNumberFormat(item2.quantity,1000)}" />
												</p:column>
											 </p:dataTable>
										</p:rowExpansion>
									</p:dataTable>
								 </div>
							   </div>
		                   </div>
		               </div>
		           </h:panelGroup>
		       </p:tab>
		       <p:tab id="tab1"  title="Danh sách hóa đơn"  >
		           <div class="col-md-12"  style="padding-left:0px !important; padding-right: 0px !important;background-color: #eeeeee;padding-top: 15px; padding-bottom: 15px;">
	              <div class="col-md-12">
					  <p:commandLink id="idorder" styleClass="btn_primmary" style="margin-left:1px; margin-right:0px;height:28px !important;line-height:28px !important;" >
				                    <i class="fa fa-search" aria-hidden="true"></i><span>Tìm kiếm</span>
				      </p:commandLink>
	                  <p:overlayPanel id="imagePanel" for="idorder" hideEffect="fade" dismissable="false"
								widgetVar="panelsearch" style="width:360px;">
						<div class="col-md-12"
											style="border: 1px solid #ccc; border-radius: 6px; margin-bottom: 5px !important;">
							    <div class="col-md-12" style="padding-top:10px !important;padding-left: 0px !important; padding-right: 0px !important;">
	                                   <div class="row">
	                                       <div class="col-md-6" style="padding-left: 0px !important; padding-right: 5px !important;">
	                                           <label>Từ ngày</label>
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 5px !important; padding-right: 0px !important;">
	                                           <label>Đến ngày</label>
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 0px !important; padding-right: 5px !important; margin-bottom:5px;" >
	                                          <p:calendar value="#{invoiceStockerBean.fromDateSearch}" pattern="dd/MM/yyyy" showOn="button" mask="99/99/9999" showButtonPanel="true"/>
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 5px !important; padding-right: 0px !important; margin-bottom:5px;" >
	                                            <p:calendar value="#{invoiceStockerBean.toDateSearch}" pattern="dd/MM/yyyy" showOn="button" mask="99/99/9999" showButtonPanel="true"/>
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 0px !important; padding-right: 5px !important;">
	                                           <label>Mã hóa đơn</label>
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 5px !important; padding-right: 0px !important;">
	                                           <label>Số chứng từ</label>
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 0px !important; padding-right: 5px !important; margin-bottom:5px;" >
	                                          <p:inputText value="#{invoiceStockerBean.invoiceCodeSearch}" style="width:100%" />
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 5px !important; padding-right: 0px !important; margin-bottom:5px;" >
	                                           <p:inputText value="#{invoiceStockerBean.voucherCodeSearch}" style="width:100%" />
	                                       </div>
	                                       <div class="col-md-12" style="padding-left: 0px !important;padding-right:0px !important;">
	                                           <label>Khách hàng</label>
	                                       </div>
	                                       <div class="col-md-12" style="padding-left: 0px !important; padding-right: 0px !important; margin-bottom:5px;" >
	                                           <div class="nhapdlg">
									             <span class="fa fa-search"></span>
												  <p:autoComplete style="width:100%;"
													value="#{invoiceStockerBean.customerSearch}" placeholder="Tìm khách hàng"
													converter="abstractConverter" minQueryLength="2" 
													completeMethod="#{invoiceStockerBean.completeCustomer}" var="p"
													itemLabel="#{p.customer_name}" itemValue="#{p}"
													forceSelection="true" onclick="this.select();">
													<p:column style="width:50px">
													   <h:outputText value="#{p.customer_code}" />
													</p:column>
													<p:column style="width:150px">
													    <h:outputText value="#{p.customer_name}" />
													 </p:column>
												</p:autoComplete>
											    </div>
	                                       </div>
	                                       <div class="col-md-12" style="padding-left:0px !important; padding-right:0px !important; ">
	                                           <label>Loại xuất nhập</label>
	                                       </div>
	                                       <div class="col-md-12" style="padding-left: 0px !important; padding-right: 0px !important; margin-bottom:5px;" >
	                                          <p:selectOneMenu 
													value="#{invoiceStockerBean.ieCategoriesSearch}"
													converter="abstractConverter" effect="fade" var="t"
													style="width:100%;" filter="true" filterPlaceholder="Tìm kiếm"
											        filterMatchMode="custom" filterFunction="customFilter2">
													 <f:selectItem itemLabel="Tất cả" itemValue="#{null}" />
													<f:selectItems value="#{invoiceStockerBean.listIECategories}"
														var="theme" itemLabel="#{theme.old_code}-#{theme.content}"
														itemValue="#{theme}" />
													<p:column>
														<h:outputText value="#{t.code}" />
													</p:column>
													<p:column>
														<h:outputText value="#{t.old_code}" />
													</p:column>
													<p:column>
														<h:outputText value="#{t==null ? 'Tất cả' : t.content}" />
													</p:column>
												</p:selectOneMenu>
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 0px !important;padding-right: 5px !important;">
	                                           <label>P/O</label>
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 5px !important; padding-right:0px !important;">
	                                           <label>Mã đơn hàng</label>
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 0px !important; padding-right: 5px !important; margin-bottom:5px;" >
											    <p:inputText value="#{invoiceStockerBean.poNoSearch}" style="width:100%" />
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 0px !important; padding-right: 5px !important; margin-bottom:5px;" >
											    <p:inputText value="#{invoiceStockerBean.orderCodeSearch}" style="width:100%" />
	                                       </div>
	                                        <div class="col-md-6" style="padding-left: 0px !important;padding-right: 5px !important;">
	                                           <label>Số đơn hàng</label>
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 5px !important; padding-right:0px !important;">
	                                           <label>Trạng thái</label>
	                                       </div>
	                                        <div class="col-md-6" style="padding-left: 0px !important; padding-right: 5px !important; margin-bottom:5px;" >
											    <p:inputText value="#{invoiceStockerBean.orderVoucherSearch}" style="width:100%;" />
	                                       </div>
	                                       <div class="col-md-6" style="padding-left: 0px !important; padding-right: 5px !important; margin-bottom:5px;" >
											    <p:selectOneMenu 
													value="#{invoiceStockerBean.paymentSearch}"
													converter="integerConverter" effect="fade" var="t"
													style="width:100%;">
													 <f:selectItem itemLabel="Tất cả" itemValue="-1" />
										            <f:selectItem itemLabel="Chưa thanh toán" itemValue="1" />
										            <f:selectItem itemLabel="Đã thanh toán" itemValue="0" />
												</p:selectOneMenu>
	                                       </div>
	                                   </div>
	                                 </div>
						  </div>
							<div class="col-md-12" style="padding-left: 0px !important;padding-right: 0px !important; margin-bottom: 5px;">
							   <div class="pull-right">
									<p:commandButton value="Tìm" process="imagePanel" 
									icon="ui-icon-search" oncomplete="PF('panelsearch').hide()"
									actionListener="#{invoiceStockerBean.search()}"
									update="tablesp" />
								</div>
							</div>
					  </p:overlayPanel>
	              </div>
	              <div class="col-md-12" style="margin-top: 3px;">
	                <p:dataTable value="#{invoiceStockerBean.listInvoice}" 
							paginatorPosition="bottom" styleClass="tablenhapsp tableright1"
							paginator="true" rowKey="#{item.id}" id="tablesp" style="width:100%;"
							scrollable="true" scrollHeight="700"  paginatorTemplate="{Exporters}"
							selection="#{invoiceStockerBean.invoiceSelect}" 
							selectionMode="single" resizableColumns="true" var="item">
						<f:facet name="{Exporters}">
							  <span class="pagecurrentdisplay">
							     <h:outputText value="(#{invoiceStockerBean.navigationInfo.currentPage} of #{invoiceStockerBean.navigationInfo.totalPage})" />
							  </span>
							  <ul class="pagination pagination-sm" style="margin: 0px 0px !important;">
							      <li><p:commandLink disabled="#{invoiceStockerBean.navigationInfo.currentPage ==1}" styleClass="fa fa-angle-double-left font_weightcus"  update="tablesp" actionListener="#{invoiceStockerBean.paginatorChange(1)}" /> </li>
							      <li><p:commandLink disabled="#{invoiceStockerBean.navigationInfo.currentPage ==1}" styleClass="fa fa-angle-left font_weightcus"  update="tablesp" actionListener="#{invoiceStockerBean.paginatorChange(invoiceStockerBean.navigationInfo.currentPage-1)}" /> </li>
								  <c:forEach var="index" items="#{invoiceStockerBean.navigationInfo.indexList}">
									  <li class="#{invoiceStockerBean.navigationInfo.currentPage==index ? 'active' : ''}"><p:commandLink   update="tablesp" value="#{index}" actionListener="#{invoiceStockerBean.paginatorChange(index)}" /> </li>
								  </c:forEach>
								  <li><p:commandLink disabled="#{invoiceStockerBean.navigationInfo.currentPage == invoiceStockerBean.navigationInfo.totalPage}" styleClass="fa fa-angle-right font_weightcus"  update="tablesp" actionListener="#{invoiceStockerBean.paginatorChange(invoiceStockerBean.navigationInfo.currentPage +1)}" /></li>
							      <li><p:commandLink disabled="#{invoiceStockerBean.navigationInfo.currentPage == invoiceStockerBean.navigationInfo.totalPage}" styleClass="fa fa-angle-double-right font_weightcus"  update="tablesp" actionListener="#{invoiceStockerBean.paginatorChange(invoiceStockerBean.navigationInfo.totalPage)}" /></li>
								</ul>
								<span class="rowperpage">
						        <p:selectOneMenu 
									value="#{invoiceStockerBean.pageSize}"
									converter="abstractConverter" effect="fade" var="t"
									style="width:50px;margin-left:10px !important;">
									<f:selectItems value="#{invoiceStockerBean.listRowPerPage}"
										var="theme" itemLabel="#{theme}"
										itemValue="#{theme}" />
									<p:column>
										<h:outputText value="#{t}" />
									</p:column>
									<p:ajax update="tablesp"  listener="#{invoiceStockerBean.paginatorChange(1)}"></p:ajax>
								</p:selectOneMenu>
						        </span>
					     </f:facet>
					     <p:ajax event="rowSelect" listener="#{invoiceStockerBean.showEditInvoice()}" update="menuformid:tabview1:tab2real,menuformid:tabview1:tongthue,menuformid:tabview1:tongtien" />
							<p:column headerText="Mã Hóa đơn" width="70">
								<h:outputText value="#{item.invoice_code}" />
							</p:column>
							<p:column headerText="Số chứng từ" width="100">
								<h:outputText value="#{item.voucher_code}" />
							</p:column>
							<p:column width="100" headerText="Xuất hàng" styleClass="textcenter">
							      <span style="color:red;display:#{item.exported==false ? 'inline-block' :'none'}">Chưa xuất hàng</span>
						          <span style="color:#03A9F4;display:#{item.exported==true ? 'inline-block' :'none'}">Đã xuất hàng</span>
							</p:column>
							<p:column headerText="Ngày hóa đơn" width="75">
								 <h:outputText value="#{item.invoice_date}">
									<f:convertDateTime pattern="dd/MM/yyyy"/>
								  </h:outputText>
							</p:column>
							<p:column headerText="Ngày giao" width="70">
								 <h:outputText value="#{item.delivery_date}">
									<f:convertDateTime pattern="dd/MM/yyyy"/>
								  </h:outputText>
							</p:column>
							<p:column headerText="Khách hàng" width="250">
								<h:outputText style="white-space: initial;" value="#{item.customer.customer_name}" />
							</p:column>
							<p:column headerText="Người tạo" width="120">
							    <h:outputText value="#{item.created_by}" />
							</p:column>
							<p:column headerText="Số xe" width="80" >
								<h:outputText value="#{item.car.license_plate}" />
							</p:column>
							<p:column headerText="P/O" width="80" >
								<h:outputText value="#{item.po_no}" />
							</p:column>
							<p:column headerText="Loại xuất nhập" width="120" >
								<h:outputText value="#{item.ie_categories.content}" />
							</p:column>
							<p:column headerText="CT.Đơn giá" width="80">
							    <h:outputText value="#{item.pricing_program.program_code}" />
							</p:column>
							<p:column headerText="CT.Khuyến mãi" width="80">
							    <h:outputText value="#{item.promotion_program.program_code}" />
							</p:column>
							<p:column headerText="Kho" width="120">
							    <h:outputText value="#{item.warehouse.name}" />
							</p:column>
							<p:column headerText="Ghi chú" width="80" >
								<h:outputText value="#{item.note}" />
							</p:column>
					</p:dataTable>
	          </div>
	           </div>
		       </p:tab>
		      </p:tabView>
		 </h:form>
	</div>
	
	<p:dialog styleClass="dialogcommon" resizable="false" width="500" style="overflow: initial;"
		closeOnEscape="true" header="Chọn lô hàng" widgetVar="dlgexport">
		<f:facet name="header">
            <h:form id="dlgheader">
              <h:outputText style="font-size:13px;" value="#{invoiceStockerBean.wrapInvoiceDetailPick.invoice_detail.product.product_name}" />
            </h:form>
        </f:facet>
		<h:form id="dlgexport" style="width:100%;">
		      <div class="col-md-12" style="padding-left:0px !important; padding-right:0px !important; margin-top: 5px; margin-bottom: 10px;">
		          <div class="row">
			           <div class="col-md-6" style="padding-left: 3px !important;padding-right:3px !important;">
			                <label>Số lượng yêu cầu</label>
			           </div>
			           <div class="col-md-6" style="padding-left: 2px !important;padding-right:0px !important;">
			                <label>Số lượng thực xuất</label>
			           </div>
			           <div class="col-md-6" style="padding-left: 3px !important;padding-right:3px !important;">
			               <p:inputText style="color: red;font-weight: bold;font-size: 14px;" readonly="true" value="#{invoiceStockerBean.formatHandler.getNumberFormat(invoiceStockerBean.wrapInvoiceDetailPick.invoice_detail.quantity,1000)}" />
			           </div>
			           <div class="col-md-6" style="padding-left: 2px !important;padding-right:0px !important;">
			                <p:inputText style="color: red;font-weight: bold;font-size: 14px;" readonly="true"  value="#{invoiceStockerBean.formatHandler.getNumberFormat(invoiceStockerBean.wrapInvoiceDetailPick.invoice_detail.real_quantity,1000)}" />
			           </div>
		          </div>
		      </div>
		      <div class="col-md-12" style="padding-left:0px !important; padding-right:0px !important;">
		          <p:dataTable id="xuatLH" style="width:100%; min-height:100px; height:auto;" styleClass="tablenhapsp tableright0" scrollable="true" 
		          scrollHeight="200" var="itemex" value="#{invoiceStockerBean.listWrapExportData}" paginatorPosition="bottom" rowsPerPageTemplate="90,180,250" >
			        <p:column headerText="" width="10" styleClass="textcenter">
			           <p:selectBooleanCheckbox value="#{itemex.select}">
			              <p:ajax event="change" listener="#{invoiceStockerBean.selectExportBatch(itemex)}" update="dlgexport,messages" />
			           </p:selectBooleanCheckbox>
			        </p:column>
			        <p:column headerText="Lô hàng" width="20"  styleClass="textcenter" >
			           <h:outputText  value="#{itemex.export_batch.batch.batch_code}" />
			        </p:column>
			        <p:column headerText="số lượng tồn" width="33"  styleClass="textright">
			           <h:outputText  value="#{invoiceStockerBean.formatHandler.getNumberFormat(itemex.export_batch.batch.quantity_import-itemex.export_batch.batch.quantity_export,1000)}" />
			        </p:column>
			        <p:column headerText="số lượng xuất" width="40">
			            <p:inputNumber   onclick="this.select()" value="#{itemex.quantity_export}" styleClass="inputtext_nhapsp input_red" style="width:100%;"
							minValue="0" decimalPlaces="0" decimalSeparator="," maxValue="10000000" thousandSeparator=".">
                          <p:ajax event="keyup" delay="700" listener="#{invoiceStockerBean.changeQuantityExportBatch(itemex)}" update="dlgexport,messages" />
                        </p:inputNumber>
			        </p:column>
			    </p:dataTable>
		      </div>
		      <div class="col-md-12" style="padding-left:0px !important;padding-right:0px !important;">
		           <p:commandLink  update="messages"   action="#{invoiceStockerBean.saveOrUpdateExportBatch()}" styleClass="btn_primmary" style=" " >
	                    <i class="fa fa-floppy-o" aria-hidden="true"></i><span>Lưu/Cập nhật</span>
	              </p:commandLink>
		      </div>
		</h:form>
	</p:dialog>
	<p:dialog styleClass="dialogcommon radioreponsive" resizable="false" width="660" style="overflow: initial;"
		closeOnEscape="true" header="Lựu chọn In" widgetVar="idlg2">
		<h:form id="idlg2" style="width:100%;">
	      <div class="col-md-12" style="padding-left:0px !important; padding-right:0px !important;border-top: 1px solid #904d4dcc; margin-top: 5px;">
	          <div class="row">
	           <div class="col-md-10" style="padding-left:0px !important; padding-right:3px;">
		            <p:selectOneRadio value="#{invoiceStockerBean.reportTypeIEInVoiceSelect}" layout="responsive" columns="2" converter="abstractConverter">
				        <f:selectItems value="#{invoiceStockerBean.listSelectReport}" var="t" itemLabel="#{t.name}" itemValue="#{t}"/>
				    </p:selectOneRadio>
			   </div>
			   <div class="col-md-2" style="padding-left: 3px !important; padding-right:0px !important;padding-top: 43px;">
			        <p:commandLink process="@all" actionListener="#{invoiceStockerBean.processPrintPDFReport()}" styleClass="btn_primmary" style="margin-left:0px; margin-right:0px;height:29px !important;line-height:29px !important;" >
		                    <i class="fa fa-file-pdf-o" aria-hidden="true"></i><span>Xuất pdf</span>
		            </p:commandLink>
			   </div>
			    
	          </div>
	      </div>
		</h:form>
	</p:dialog>
	
	
	
	</ui:define>
</ui:composition>